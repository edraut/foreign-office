<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Foreign-office by edraut</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="/foreign-office">Foreign-office</a></h1>
        <p>A light browser push framework that provides functionality for listeners on web clients and publishers on Rails servers. Keep your business logic on the server whenever you can!</p>
        <p class="view"><a href="https://github.com/edraut/foreign-office">View the Project on GitHub <small>edraut/foreign-office</small></a></p>
        <ul>
          <li><a href="https://github.com/edraut/foreign-office/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/edraut/foreign-office/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/edraut/foreign-office">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>What happens when my client receives a published message?</h2>

<p>If you use the base class data-listener=&quot;true&quot;, then foreign office makes some assumptions about what to do with your message, mostly based on the kind of html element you&#39;re binding to.</p>

<h4>Replace the inner html of an element with the value published for your channel/key combo:</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;div data-listener=&quot;true&quot; data-channel=&quot;Transaction_123&quot; data-key=&quot;grand_total&quot;&gt;
&lt;/div&gt;
</code></pre></div>
<p>This has endless uses. We use it a lot to keep an ajax-heavy page consistent when data is repeated or aggregated multiple times on a page and you don&#39;t want to write business logic about relationships on the client.</p>

<h4>Update the href with the published value and click the link:</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;a href=&quot;you_win.html&quot;
  data-listener=&quot;true&quot;
  data-channel=&quot;S3_report_123&quot;
  data-key=&quot;download_url&quot;
  data-trigger-on-message=&quot;true&quot;&gt;
&lt;/a&gt;
</code></pre></div>
<p>That one is handy if you generate a file in a background worker and need to make the client download as soon as it&#39;s done.</p>

<h4>Replace an image with the one at the url provided in the published value:</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;img src=&quot;&quot;
  data-listener=&quot;true&quot;
  data-channel=&quot;Photo_123&quot;
  data-key=&quot;thumbnail_url&quot;&gt;
&lt;/img&gt;
</code></pre></div>
<p>We process images in the background, but would like to populate the thumbnail when it&#39;s ready.</p>

<h4>Replace the value of a form input with the published value:</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;input type=&quot;number&quot;
  name=&quot;total&quot;
  data-listener=&quot;true&quot;
  data-channel=&quot;Transaction_123&quot;
  data-key=&quot;total&quot;&gt;
&lt;/input&gt;
</code></pre></div>
<p>This one is useful when mutliple ajax forms exist on a page and each may affect values on the other.</p>

<h2>Can it do anything fancier than that?</h2>

<p>We&#39;re so glad you asked.</p>

<h4>Hide or show an element:</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;div data-listener=&quot;ForeignOfficeRevealer&quot;
  data-channel=&quot;MyResource_123&quot;
  data-key=&quot;deletable?&quot;&gt;
  ... some delete form here ...
&lt;/div&gt;
</code></pre></div>
<p>Don&#39;t let users delete an object that shouldn&#39;t be deleted, but if it&#39;s allowed, then show them the delete button.</p>

<h4>Add new items to a list via ajax:</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;div id=&quot;my_list&quot;
  data-listener=&quot;ForeignOfficeNewListItems&quot;
  data-channel=&quot;List_123&quot;
  data-key=&quot;new_item_get_url&quot;&gt;
&lt;/div&gt;
</code></pre></div>
<p>This is handy for ajaxy pages that have resources with has_many lists. You might add a new item via ajax that needs to be processed in the background (like sending an email and listing the time/recipient/etc.) If your worker publishes the GET url of the newly created item to your container channel, foreign office will fetch it via ajax and append the results to the list.</p>

<h2>More?</h2>

<p>We&#39;re excited to extend this to add more behaviors if they seem generally useful. Please let us know what you&#39;re looking for and we&#39;ll add commonly requested behaviors.</p>

<h4>Write your own behavior</h4>

<p>It&#39;s pretty easy to extend foreign office to do what you want when you receive a message</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var ForeignOfficeSquawk = ForeignOfficeListener.extend({
  handleMessage: function(m){
    var current_value = m.object[this.object_key];
    if(&#39;squeek&#39; == current_value){
      alert(&quot;squeek!!!&quot;);
      this.$listener.flash();
    } else if(&#39;squawk&#39; == current_value){
      alert(&quot;squawk.&quot;)
      this.$listener.css({&#39;background-color&#39;: &#39;pink&#39;});
    }
  }
});
</code></pre></div><div class="highlight"><pre><code class="language-html" data-lang="html">&lt;div data-listener=&quot;ForeignOfficeSquawk&quot;
  data-channel=&quot;StrangeBird&quot;
  data-key=&quot;utterance&quot;&gt;
  Odd duck says...
&lt;/div&gt;
</code></pre></div>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/edraut">edraut</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>